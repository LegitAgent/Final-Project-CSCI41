{% extends 'base.html' %}
{% load static %}

{% block content %}   
  <main class="d-flex justify-content-center align-items-center py-12" id="register-page">
    <!-- Alert-->
    {% if register_form.non_field_errors %}
      <div class="alert alert-dismissible alert-danger d-flex flex-column flex-sm-row p-5 mb-10 mx-auto z-index-3 w-100 w-lg-900px position-absolute top-0 left-0 right-0">
        <i class="ki-duotone ki-information-5 fs-2hx text-danger me-4 d-none d-md-block">
          <span class="path1"></span>
          <span class="path2"></span>
          <span class="path3"></span>
        </i>

        <div class="d-flex flex-column text-danger pe-0 pe-sm-10">
            <h4 class="mb-2 text-danger d-flex d-md-inline">
              <i class="ki-duotone ki-information-5 fs-1 text-danger me-4 d-md-none d-block ">
                <span class="path1"></span>
                <span class="path2"></span>
                <span class="path3"></span>
              </i>
              Form Submission Failure
            </h4>
            <span>The following errors have occured:</span>
            <ul class="mb-0 pb-0">
              {% for error in register_form.non_field_errors %}
                <li>{{ error }}</li>            
              {% endfor %}
            </ul>
        </div>
        <button type="button" class="position-absolute position-sm-relative m-2 m-sm-0 top-0 end-0 btn btn-icon ms-sm-auto" data-bs-dismiss="alert">
          <i class="fa-solid fa-xmark text-danger fs-2"></i>
        </button>
      </div>
    {% endif %}
    
    <div class="card d-flex flex-column align-items-stretch flex-center rounded-4 w-md-450px pb-10">
      <header class="d-flex flex-row w-100 fs-5 fw-semibold text-center mb-10">
        <a href="#" class="w-100 border-bottom border-2 border-primary py-4">Participant</a>
        <a href="/account/register/organizer" class="w-100 text-gray-600 border-bottom border-2 py-4">Organizer</a>
      </header>
      <form method="POST" id="register-participant-form" class="form w-100 px-12 fv-plugins-bootstrap5 fv-plugins-framework">
        {% csrf_token %}
        
        <div class="text-center mb-11">
          <h1 class="text-gray-900 fw-bolder mb-3">Create an Account</h1>
        </div>
        <div class="fv-row mb-8 fv-plugins-icon-container">
          {{ register_form.id_number }}
          <div class="fv-plugins-message-container fv-plugins-message-container--enabled invalid-feedback">
            {% for error in register_form.id_number.errors %}
                {{ error }}
            {% endfor %}
          </div>
        </div>
        <div class="fv-row mb-8 fv-plugins-icon-container">
          {{ register_form.name }}
        </div>

        <div class="input-group fv-row mb-8 fv-plugins-icon-container">
          <span class="input-group-text" id="dob-input-icon">
            <i class="ki-duotone ki-calendar fs-2">
              <span class="path1"></span>
              <span class="path2"></span>
            </i>
          </span>
          {{ register_form.birthdate }}
          <input class="form-control" placeholder="Select your birthdate" id="custom_datepicker"  aria-describedby="dob-input-icon"/>
        </div>

        <div class="d-flex flex-row mb-8 gap-8">
         <div class="fv-row fv-plugins-icon-container w-100">
            {{ register_form.department }}
          </div>
          <div class="fv-row fv-plugins-icon-container w-100">
            {{ register_form.participant_type }}
          </div>
        </div>

        <div class="fv-row mb-8 fv-plugins-icon-container">
          {{ register_form.password1 }}
          <div class="fv-plugins-message-container fv-plugins-message-container--enabled invalid-feedback">
            {% for error in register_form.password1.errors %}
                {{ error }}
            {% endfor %}
          </div>
        </div>
        <div class="fv-row mb-8 fv-plugins-icon-container">
          {{ register_form.password2 }}
          <div class="fv-plugins-message-container fv-plugins-message-container--enabled invalid-feedback">
            {% for error in register_form.password2.errors %}
                {{ error }}
            {% endfor %}
          </div>
        </div>

        <input id="register-submit" type="button" onclick="formSubmit()" class="btn btn-primary w-100 mb-10" value="Sign Up" />
        <div class="text-gray-500 text-center fw-semibold fs-6">
          Already have an account?
          <a href="{% url 'login' %}" class="link-primary">Login</a>
        </div>
      </form>
    </div>
  </main>
{% endblock %}

{% block scripts %}
<script>
  let fp = $("#custom_datepicker").flatpickr({dateFormat: "F j, Y"});

  const formSubmit = () => {
    let date = fp.formatDate(fp.selectedDates[0], "Y-m-d H:i:S");
    $("#id_birthdate").val(date);
    $("#register-participant-form").submit();
  }

</script>
{% endblock %}